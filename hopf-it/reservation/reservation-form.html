<style type="text/css">
    .tg  {border-collapse:collapse;border-spacing:0;}
    .tg td{font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;}
    .tg th{font-family:Arial, sans-serif;font-size:14px;font-weight:normal;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;}
</style>

<h2>Reservierungs Formular</h2>

<h3>Leistung</h3>
<div>
    <ul>
        <li>1 Stunde pers&ouml;nliche Online Beratung mit Markus Hopf</li>
    </ul>
</div>
<h3>Kosten</h3>
<div>
    <ul>
        <li>150 € netto (178,50 € brutto inkl. 19%)</li>
    </ul>
</div>

<h3>Ihre E-Mail Adresse</h3>
<div>
    <input name='emailId' id='emailId' style='height: 45px;' type='text' maxlength='40' value='' size='40' onblur='clearError()'/>
    <br>
    <span id='errorEmailId' style='color: red; display: none'></span>
</div>

<h3>Verf&uuml;gbare pers&ouml;nliche Online Beratungs Zeiten f&uuml;r diese Woche</h3>

<div style="float: left;">
    <table class="tg">
        <tr>
            <th class="tg-031e">Montag</th>
        </tr>
        <tr>
            <td class="tg-031e">17:00 Uhr<br><button id="buttonReservierenId1" style='font-size:large; height: 50px; width: 130px;' type="button" onclick="reservieren('buttonReservierenId1', 'Montag', '17:00')">Reservieren</button></td>
        </tr> 
    </table>
</div>
<div style="float: left;">
    <table class="tg">
        <tr>
            <th class="tg-031e">Dienstag</th>
        </tr>
        <tr>
            <td class="tg-031e">17:00 Uhr<br><button id="buttonReservierenId2" style='font-size:large; height: 50px; width: 130px;' type="button" onclick="reservieren('buttonReservierenId2', 'Dienstag', '17:00')">Reservieren</button></td>
        </tr> 
    </table>
</div>
<div style="float: left;">
    <table class="tg">
        <tr>
            <th class="tg-031e">Mittwoch</th>
        </tr>
        <tr>
            <td class="tg-031e">17:00 Uhr<br><button id="buttonReservierenId3" style='font-size:large; height: 50px; width: 130px;' type="button" onclick="reservieren('buttonReservierenId3', 'Mittwoch', '17:00')">Reservieren</button></td>
        </tr> 
    </table>
</div>
<div style="float: left;">
    <table class="tg">
        <tr>
            <th class="tg-031e">Donnerstag</th>
        </tr>
        <tr>
            <td class="tg-031e">17:00 Uhr<br><button id="buttonReservierenId4" style='font-size:large; height: 50px; width: 130px;' type="button" onclick="reservieren('buttonReservierenId4', 'Donnerstag', '17:00')">Reservieren</button></td>
        </tr> 
    </table>
</div>
<div style="float: left;">
    <table class="tg">
        <tr>
            <th class="tg-031e">Freitag</th>
        </tr>
        <tr>
            <td class="tg-031e">17:00 Uhr<br><button id="buttonReservierenId5" style='font-size:large; height: 50px; width: 130px;' type="button" onclick="reservieren('buttonReservierenId5', 'Freitag', '17:00')">Reservieren</button></td>
        </tr> 
    </table>
</div>


<!-- <div style="float: left;">
    <table class="tg">
        <tr>
            <th class="tg-031e">Freitag</th>
        </tr>
        <tr>
            <td class="tg-031e">17:00 Uhr<br><button id="buttonReservierenId6" style='font-size:large; height: 50px; width: 130px;' type="button" onclick="reservieren('buttonReservierenId6', 'Freitag', '17:00')">Reservieren</button></td>
        </tr> 
    </table>
</div> -->

<br>
<div style="float: left;">
    <ul>
        <li>Sie erhalten sofort eine E-Mail mit einem PayPal Bezahl-Link</li>
        <li>Es kann einige Minuten dauern, bis die Reservierung hier Online sichtbar wird</li>
        <li>Die Rechnung wird Ihnen umgehend nach der pers&ouml;nlichen Online Beratung zugestellt</li>
        <li>F&uuml;r andere Terminvorschl&auml;ge, schreiben Sie mir bitte eine E-Mail <a href="mailto:info@hopf-it.de">info@hopf-it.de</a></li>
    </ul> 
</div>
<br>

<script>
    var token1 = 'ghp_';
    var token2 = 'Y56Fa4kw5ccmrG4dolafJwPYhOopcSiQ3pao';

    // Allways reserved: Mo, Mi, Fr!!
    // document.getElementById('buttonReservierenId1').disabled = true;
    // document.getElementById('buttonReservierenId3').disabled = true;
    // document.getElementById('buttonReservierenId5').disabled = true;
  
//BEGIN_PLACEHOLDER
var dynamicButton = document.getElementById("DISABLE_BUTTON_PLACEHOLDER1");
if(dynamicButton){
dynamicButton.disabled = true;
}dynamicButton = document.getElementById("buttonReservierenId2");
if(dynamicButton){
dynamicButton.disabled = true;
}dynamicButton = document.getElementById("buttonReservierenId3");
if(dynamicButton){
dynamicButton.disabled = true;
}
dynamicButton = document.getElementById("buttonReservierenId4");
if(dynamicButton){
dynamicButton.disabled = true;
}
dynamicButton = document.getElementById("DISABLE_BUTTON_PLACEHOLDER5");
if(dynamicButton){
dynamicButton.disabled = true;
}
//END_PLACEHOLDER

    const dayOfWeekDigit = new Date().getDay();
    
    // disable, if weekday is the same day or in the past
    if(dayOfWeekDigit >= 5) { // Friday = 5
        document.getElementById('buttonReservierenId1').disabled = true;
        document.getElementById('buttonReservierenId2').disabled = true;
        document.getElementById('buttonReservierenId3').disabled = true;
        document.getElementById('buttonReservierenId4').disabled = true;
        document.getElementById('buttonReservierenId5').disabled = true;
    }
    else if(dayOfWeekDigit >= 4) { 
        document.getElementById('buttonReservierenId1').disabled = true;
        document.getElementById('buttonReservierenId2').disabled = true;
        document.getElementById('buttonReservierenId3').disabled = true;
        document.getElementById('buttonReservierenId4').disabled = true;
    }
    else if(dayOfWeekDigit >= 3) { 
        document.getElementById('buttonReservierenId1').disabled = true;
        document.getElementById('buttonReservierenId2').disabled = true;
        document.getElementById('buttonReservierenId3').disabled = true;
    }
    else if(dayOfWeekDigit >= 2) {
        document.getElementById('buttonReservierenId1').disabled = true;
        document.getElementById('buttonReservierenId2').disabled = true;
   }
    else if(dayOfWeekDigit >= 1) { // Monday = 1
        document.getElementById('buttonReservierenId1').disabled = true;
    }

    function errorMsg(message) {
        var errorElement = document.getElementById("errorEmailId");
        errorElement.style.display = '';
        errorElement.innerHTML = message; 
    }

    function clearError() {
        var emailElem = document.getElementById('emailId');
        emailElem.style.borderColor = '';
        var errorElement = document.getElementById("errorEmailId");
        errorElement.style.display = 'none';
    }

    function reservieren(buttonIdParam, reservationDayParam, reservationTimeParam) {
        var emailElem = document.getElementById('emailId');
        var emailValue = emailElem.value;
        if (emailValue == '') {
            emailElem.style.borderColor = 'red';
            window.alert = errorMsg('Bitte geben Sie zuerst Ihre E-Mail Adresse an!');
           // alert('Bitte geben Sie zuerst Ihre E-Mail Adresse an!');
            return;
        }
        const validateEmail = (emailValue) => {
            return String(emailValue)
                .toLowerCase()
                .match(
                /^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/
                );
        }; 
        if (validateEmail(emailValue) == null) { 
            emailElem.style.borderColor = 'red'; 
            window.alert = errorMsg('Bitte geben Sie eine <b>korrekte</b> E-Mail Adresse ein!');    
           // alert('Bitte geben Sie eine korrekte E-Mail Adresse ein!');
            return;
        }

        if (confirm('Ihre Reservierungs Daten:\n\nE-Mail ' + emailValue +  '\nTag ' + reservationDayParam + '\nZeit ' + reservationTimeParam + ' Uhr\nPreis 150 € netto (178,50 € brutto inkl. 19%)\n\nMöchten Sie jetzt reservieren?') == false) {
            return;
        }

        // Disable currently clicked button
        document.getElementById(buttonIdParam).disabled = true;
    //    emailElem.style.borderColor = '';

        var url = 'https://api.github.com/repos/Hefezopf/hopf-it.de/dispatches';
        var xhr = new XMLHttpRequest();
        xhr.open('POST', url);
        xhr.setRequestHeader('Authorization', 'token ' + token1 + token2.split("").reverse().join(""));
        xhr.setRequestHeader('Accept', 'application/vnd.github.everest-preview+json');
        xhr.onreadystatechange = function () {
            if (xhr.readyState === 4) {
                console.log(xhr.status);
                console.log(xhr.responseText);
            }
        };
        var data = {
            event_type: 'reservation',
            client_payload: {
                email: emailValue,
                reservationDay: reservationDayParam,
                reservationTime: reservationTimeParam
            }
        };
        xhr.send(JSON.stringify(data));
    }
</script>
